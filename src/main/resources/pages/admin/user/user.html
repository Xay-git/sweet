<%layout("/common/_container.html"){%><div class="layui-fluid" id="app">    <div class="layui-row layui-col-space15">        <div class="layui-col-sm12 layui-col-md3 layui-col-lg2">            <div class="layui-card">                <div class="layui-card-body mini-bar">                    <div id="lay-tree" style="font-size: 15px;margin-top: 20px;"></div>                </div>            </div>        </div>        <div class="layui-col-sm12 layui-col-md9 layui-col-lg10">            <div class="layui-card">                <div class="layui-card-body">                      <div class="layui-form toolbar">                          <div class="layui-form-item">                              <div class="layui-inline">                                  <input id="condition" class="layui-input" type="text" placeholder="名称"/>                              </div>                              <div class="layui-inline">  <!--                                <button id="btnSearch" class="layui-btn icon-btn"><i class="layui-icon">&#xe615;</i>搜索</button>-->                                  <button id="btnAdd" @click="btnAdd" class="layui-btn icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>                                  <!--                                <button id="btnExp" class="layui-btn icon-btn"><i class="layui-icon">&#xe67d;</i>导出</button>-->                              </div>                          </div>                      </div>                    <table class="layui-table" id="userTable" lay-filter="userTable"></table>                </div>            </div>        </div>    </div></div><script type="text/html" id="tableBar">    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">修改</a>    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a></script><!-- 表格状态列 --><script type="text/html" id="tableStateUser">    <input type="checkbox" lay-filter="ckStateUser" value="{{d.id}}" lay-skin="switch"           lay-text="正常|锁定" {{d.accountStatus=='1'?'checked':''}}/></script><script>    var  initColumn =  [[        {type: 'checkbox'},        {field: 'id', hide: true, title: 'ID'},        {field: 'userName',title: '用户名'},        {field: 'birthday',title: '出生日期'},        {field: 'deptName',title: '机构名称'},        {field: 'accountStatus',title: '账号状态', templet: '#tableStateUser'},        {align: 'center', toolbar: '#tableBar', title: '操作'}    ]];    var vm = new Vue({        el: '#app',        data: {            msg: 'Hello World!',            info:'',            tree:'',            deptTable:''        },        methods: {            btnAdd:function () {                top.layui.admin.open({                    type: 2,                    title: '添加用户',                    area:['480px','340px'],                    content: '/admin/user/user_add?deptId='+vm.info,                    end:function () {                        admin.getTempData('formOk') && vm.tableReload();                    }                });            },            tableReload:function () {                /*table.reload('userTable', {where: {                        deptId:vm.info                    }});*/                table.render({                    elem: '#userTable',                    url: '/admin/user/getUserList',                    page: true,                    height: "full-105",                    cellMinWidth: 100,                    cols: initColumn,                    where: {deptId: vm.info}                });                table.on('tool(userTable)', function (obj) {                    var event = obj.event;                    var data = obj.data;                    if (event == 'del') {                        layer.msg('点击了删除', {icon: 1});                    } else if (event == 'edit') {                        top.layui.admin.open({                            type: 2,                            title: '修改',                            content: '/admin/user/user_add?id='+data.id,                            resize:true,                            end:function () {                                admin.getTempData('formOk') && vm.tableReload();                            }                        });                    }                });            }        },        mounted:async function() {            vm = this;            vm.tree = await api.deptTree();            var treeOption = {                elem: '#lay-tree'  //绑定元素                ,id: 'demoTree' //定义索引                ,data: vm.tree                // ,edit: ['add', 'update','del']                // ,accordion: true                ,onlyIconControl:true                ,click: function(obj){                    var elem = obj.elem; //得到当前节点元素                    $('#lay-tree').find('.layui-tree-txt').removeClass('treeClick');                    $(elem).find('.layui-tree-txt').eq(0).addClass('treeClick');                    vm.info = obj.data.id                    vm.tableReload();                }                ,operate: function(obj){                    var type = obj.type; //得到操作类型：add、edit、del                    var data = obj.data; //得到当前节点的数据                    var elem = obj.elem; //得到当前节点元素                    //Ajax 操作                    var id = data.id; //得到节点索引                    if(type === 'add'){ //增加节点                        var key;                        request.$postData('/admin/dept/addDept',{deptId:id},function (res) {                            key = res.deptId;                        })                        return key;                    } else if(type === 'update'){ //修改节点                        var text = elem.find('.layui-tree-txt').html();                        data.text = text;                        api.editDept(data.id,data.text);                    }else if(type === 'del'){ //修改节点                        api.delDept(data.id);                    }                }            }            var laytree = tree.render(treeOption);            //默认点击第一个机构            $('.layui-tree').find('.layui-tree-txt').eq(0).click();            form.render();        },        updated: function () {            form.render();        }    })</script><% } %>